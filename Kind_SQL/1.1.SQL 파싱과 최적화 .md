# 1.1 SQL 파싱과 최적화

옵티마이저가 SQL을 어떻게 처리하는지, 서버 프로세스는 데이터를 어떻게 읽고 저장하는지 살펴보자.

## 1.1.1 구조적, 집합적, 선언적 질의 언어

- SQL은 관계형 데이터베이스에서 사용하는, 특수 목적을 위해 작성된, 구조화된 질의 언어이다.
- 기본적으로 구조적(Structured)이고 집합적(Set-based)이고 선언적(Declarative)인 질의 언어이다.
- 원하는 결과집합을 구조적, 집합적으로 선언하지만 그 결과집합을 만드는 과정은 절차적일 수 밖에 없다. 즉 프로시저가 필요한데 그런 프로시저를 만들어 내는 DBMS 내부 엔진이 바로 SQL 옵티마이저다. 옵티마이저가 프로그래밍을 대신 해주는 셈이다.
(사용자 → SQL → 옵티마이저 → 실행계획 → 프로시저)

### 1.1.2 SQL 최적화

- DBMS 내부에서 프로시저를 작성하고 컴파일해서 실행 가능한 상태로 만드는 전 과정 ‘SQL 최적화’ 라고 한다.
- 최적화 과정
    1. SQL 파싱
        1. 파싱 트리 생성
        2. Syntax 체크
        3. Semantic 체크
    2. SQL 최적화
        1. 옵티마이저(Optimizer)가 통계정보를 바탕으로 실행경로를 생성해서 비교 후 효율적인 하나를 선택한다.
    3. 로우 소스 생성
        1. 옵티마이저가 선택한 실행경로를 실제 실행 가능한 코드 또는 프로시저 형태로 포맷팅하는 단계다.

### 1.1.3 SQL 옵티마이저

- SQL 옵티마이저는 사용자가 원하는 작업을 가장 효율적으로 수행할 수 있는 최적의 데이터 액세스 경로를 선택해 주는 DBMS의 핵심 엔진이다.
- 옵티마이저의 최적화 단계
    1. 사용자로부터 전달받은 쿼리를 수행하는 데 후보군이 될만한 실행계획을 찾아낸다.
    2. 데이터 딕셔너리(Data Dictionary)에 수집해둔 오브젝트 통계 및 시스템 통계정보를 이용해 각 실행계획의 예상비용을 선정한다.
    3. 최저 비용을 나타내는 실행계획을 선택한다.

### 1.1.4 실행계획과 비용

- 실행계획(Execution Plan) : SQL 실행경로 미리보기
- SQL 옵티마이저가 생성한 처리절차를 사용자가 확인할 수 있게아래와 같이 트리구조로 표현한것이 실행계획이다.
- 옵티마이저가 실행경로를 선택하는 근거는 비용이다. 비용(Cost)은 쿼리를 수행하는 동안 발생할 것으로 예상하는 IO 횟수 또는 예상 소요시간을 표현한 값이다. Cost는 어디까지나 예상치이다.

### 1.1.5 옵티마이저 힌트

- SQL 옵티마이저도 대부분 좋은 선택을 하지만 완벽하진 않다.
- 통계정보에 담을 수 없는 데이터 또는 업무 특성을 활용해 개발자가 직접 더 효율적인 액세스 경로를 찾아 낼 수도 있다.
- 힌트 사용법
    - 주석 기호에 ‘+’를 붙이면 된다.
    - 힌트 안에 인자를 나열할 때 ‘,’를 사용할 수 있지만 힌트와 힌트 사이에 사용하면 안된다.
    - 테이블을 지정할 때 아래와 같이 스키마명까지 명시하면 안된다.
    - FROM 절 테이블명 옆에 ALIAS를 지정했다면 힌트에도 반드시 ALIAS를 사용해야한다.
- 기왕에 힌트를 사용할거면 빈틈없이 기술해야 한다!
- 자주 사용하는 힌트 목록 참고하기(p27)